Bootstrap: docker
From: continuumio/miniconda3

%labels
  Maicon Melo Alves <maiconmelo.ufrj@gmail.com>

%post
  # Upgrade packages to most recent versions
  apt update 

  # Basic
  apt install make autoconf g++ -y

  # Upgrade pip
  pip install pip --upgrade
  
  # Install additional packages
  pip install jupyterlab pandas onnx tensorboard matplotlib 

  # Install Intel OpenMP
  pip install intel-openmp

  # Install Intel PyTorch Extension
  pip install intel_extension_for_pytorch -f https://developer.intel.com/ipex-whl-stable-cpu

  # Install PyTorch
  pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu

  # Install jemmalloc
  #git clone https://github.com/jemalloc/jemalloc
  #cd jemalloc
  #./autogen.sh
  #make 
  #make install


%environment
  #export LD_PRELOAD=/usr/local/lib/libjemalloc.so:/opt/conda/lib/libiomp5.so:$LD_PRELOAD
  export LD_PRELOAD=/opt/conda/lib/libiomp5.so:$LD_PRELOAD

%runscript
  jupyter-lab --ip 0.0.0.0 --allow-root 
